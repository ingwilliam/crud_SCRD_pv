# Cesar Britto Ambiente de desarrollo
# cambiar el puerto local
cd /etc/postgresql/10/main
sudo nano pg_hba.conf 

#Ajustar las secuencias
ALTER SEQUENCE [nombre_secuencia] RESTART WITH [valor];
<<<<<<< HEAD

# Convocatorias Noviembre 6 del 2019
ALTER TABLE propuestas ADD porque_medio TEXT;

CREATE TABLE public.propuestasparametros
(
  id serial NOT NULL,
  propuesta integer NOT NULL,
  convocatoriapropuestaparametro integer NOT NULL,
  valor TEXT,
  fecha_actualizacion timestamp without time zone,
  fecha_creacion timestamp without time zone,
  creado_por integer NOT NULL,
  actualizado_por integer,
  CONSTRAINT propuestasparametros_pkey PRIMARY KEY (id),
  CONSTRAINT propuestasparametros_propuesta_fkey FOREIGN KEY (propuesta)
      REFERENCES public.propuestas (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasparametros_convocatoriapropuestaparametro_fkey FOREIGN KEY (convocatoriapropuestaparametro)
      REFERENCES public.convocatoriaspropuestasparametros (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasparametros_creado_por_fkey FOREIGN KEY (creado_por)
      REFERENCES public.usuarios (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION      
);

# Convocatorias Noviembre 7 del 2019
ALTER TABLE propuestas ADD ejecucion_menores_edad boolean DEFAULT FALSE;
INSERT INTO public.tablasmaestras(nombre, valor, active, fecha_creacion,creado_por) VALUES ('medio_se_entero','Alguien le contó,Correo electrónico,Equipos locales de cultura,Equipos locales de recreación y deporte,Portal web de la entidad,Portal Web de la Secretaría de Cultura, Recreación y Deporte,Prensa escrita,Radio,Redes sociales,Televisión',TRUE,NOW(),7);
ALTER TABLE participantes ADD rol TEXT;

CREATE TABLE public.propuestasdocumentos
(
  id serial NOT NULL,
  propuesta integer NOT NULL,
  convocatoriadocumento integer NOT NULL,
  id_alfresco TEXT,
  active bool NULL DEFAULT true,
  fecha_actualizacion timestamp without time zone,
  fecha_creacion timestamp without time zone,
  creado_por integer NOT NULL,
  actualizado_por integer,
  CONSTRAINT propuestasdocumentos_pkey PRIMARY KEY (id),
  CONSTRAINT propuestasdocumentos_propuesta_fkey FOREIGN KEY (propuesta)
      REFERENCES public.propuestas (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasdocumentos_convocatoriadocumento_fkey FOREIGN KEY (convocatoriadocumento)
      REFERENCES public.convocatoriasdocumentos (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasdocumentos_creado_por_fkey FOREIGN KEY (creado_por)
      REFERENCES public.usuarios (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION      
);

CREATE TABLE public.propuestaslink
(
  id serial NOT NULL,
  propuesta integer NOT NULL,
  convocatoriadocumento integer NOT NULL,
  link TEXT,
  active bool NULL DEFAULT true,
  fecha_actualizacion timestamp without time zone,
  fecha_creacion timestamp without time zone,
  creado_por integer NOT NULL,
  actualizado_por integer,
  CONSTRAINT propuestaslink_pkey PRIMARY KEY (id),
  CONSTRAINT propuestaslink_propuesta_fkey FOREIGN KEY (propuesta)
      REFERENCES public.propuestas (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestaslink_convocatoriadocumento_fkey FOREIGN KEY (convocatoriadocumento)
      REFERENCES public.convocatoriasdocumentos (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestaslink_creado_por_fkey FOREIGN KEY (creado_por)
      REFERENCES public.usuarios (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION      
);



=======
>>>>>>> desarrollo_cesar

# Convocatorias Enero 2 del 2020
UPDATE public.tiposparticipantes SET active=FALSE WHERE id=4;
UPDATE public.tiposestimulos SET nombre='Dinero' WHERE id=1;
UPDATE public.tiposestimulos SET nombre='Especie' WHERE id=2;

ALTER TABLE convocatorias DROP COLUMN propuestas_permitidas;
ALTER TABLE convocatorias ADD COLUMN propuestas_permitidas Integer DEFAULT NULL;

INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Anulada', true, 7, 3);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Por Subsanar', true, 7, 4);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Subsanación Recibida', true, 7, 5);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Rechazada', true, 7, 6);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Habilitada', true, 7, 7);

INSERT INTO public.modulos (nombre, active, creado_por) VALUES('Mi perfil', true, 7);
INSERT INTO public.modulos (nombre, active, creado_por) VALUES('Verificación de propuestas', true, 7);
INSERT INTO public.modulos (nombre, active, creado_por) VALUES('Verificación documentos administrativos', true, 7);
INSERT INTO public.modulos (nombre, active, creado_por) VALUES('Verificación documentos técnicos', true, 7);

ALTER TABLE propuestas ADD verificacion_administrativos boolean DEFAULT FALSE;
ALTER TABLE propuestas ADD verificacion_tecnicos boolean DEFAULT FALSE;

# Enero 16 del 2020
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_1', 'Cumple', true, 7, 1);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_1', 'No Cumple', true, 7, 2);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_1', 'Subsanar', true, 7, 3);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_1', 'No Aplica', true, 7, 4);

INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_2', 'Cumple', true, 7, 1);
INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('verificacion_2', 'No Cumple', true, 7, 2);


INSERT INTO public.programas (nombre, active, creado_por) VALUES('Programa Distrital Salas Concertadas', true, 7);

INSERT INTO public.modalidades (nombre, active, creado_por, programa) VALUES ('Cerrada', true, 7, 2);
INSERT INTO public.modalidades (nombre, active, creado_por, programa) VALUES ('Salas concertadas', true, 7, 3);

ALTER TABLE tiposeventos ADD COLUMN programas text;

UPDATE public.tiposeventos SET programas='1' WHERE id>0;

UPDATE public.tiposeventos SET programas='1,2,3' WHERE id IN (12,11,16,13,17,15,14);

ALTER TABLE requisitos ADD COLUMN programas text;
UPDATE public.requisitos SET programas='1' WHERE id>0;

UPDATE public.requisitos SET programas='1,3' WHERE id IN (943,960,937,944,941,945,961);


INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia de los estatutos de la entidad participante.', true, 7, 8,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Carta de certificación firmada por el representante legal en la que manifiesta que la entidad participante se encuentra inscrita como Proveedor del Estado Colombiano en el sistema de información Colombia Compra Eficiente/ Secop II.', true, 7, 9,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia del acta de la Junta Directiva en donde se autoriza al representante legal de la persona jurídica participante para suscribir contratos con el Instituto Distrital de las Artes.', true, 7, 10,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Certificado de inspección, vigilancia y control de la entidad participante, expedido por la Dirección de Personas Jurídicas de la SCRD o por la autoridad encargada de ejercer la inspección, vigilancia y control, correspondiente a la vigencia actual, sin observaciones pendientes.', true, 7, 11,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia legible del Registro Único Tributario (RUT) actualizado.', true, 7, 12,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia legible del Registro de Información Tributaria (RIT) actualizado.', true, 7, 13,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Certificado expedido por el revisor fiscal o por el representante legal.', true, 7, 14,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia legible de la declaración de renta o de ingresos y patrimonio.', true, 7, 15,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Copia legible del conjunto completo de estados financieros comparativos.', true, 7, 16,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Certificación, firmada por el representante legal de la entidad participante en donde conste, bajo la gravedad de juramento, que la entidad sin ánimo de lucro cuenta con una estructura organizacional, de administración y control que le permite ejecutar el proyecto presentado de manera idónea y responsable.', true, 7, 16,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Una carta de compromiso de la organización participante en la que conste que aportará o gestionará los recursos para la cofinanciación del proyecto, firmada por el represente legal.', true, 7, 17,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Mínimo cinco (5) y máximo ocho (8) certificaciones o actas de liquidación, expedidas por entidades públicas o privadas con las que la entidad participante haya suscrito contratos o convenios en los últimos cinco (5) años.', true, 7, 18,'1,3');
INSERT INTO public.requisitos (tipo_requisito, nombre, active, creado_por, orden,programas) VALUES('Administrativos', 'Certificación, firmada por el representante legal en donde se manifieste, bajo la gravedad del juramento, que el representante legal, los miembros dignatarios y demás miembros de la persona jurídica, no hacen parte de la lista de personas políticamente expuestas, en cumplimiento de lo establecido en el Decreto 1674 del 21 de octubre de 2016.', true, 7, 19,'1,3');

# Enero 27 2020
UPDATE public.requisitos SET nombre='Certificado de existencia y representación legal de la persona jurídica participante.'  WHERE id=961;
UPDATE public.requisitos SET nombre='Copia de los estatutos de la entidad participante.'  WHERE id=1052;
UPDATE public.requisitos SET nombre='Carta de certificación de inscripción en el sistema Colombia Compra Eficiente/ Secop II.'  WHERE id=1053;
UPDATE public.requisitos SET nombre='Documento de identidad del representante legal de la persona jurídica participante.'  WHERE id=941;
UPDATE public.requisitos SET nombre='Acta de la Junta Directiva en donde se autoriza al representante legal de la persona jurídica participante para suscribir contratos con el Instituto Distrital de las Artes.'  WHERE id=1054;
UPDATE public.requisitos SET nombre='Certificado de inspección, vigilancia y   control de la entidad participante.'  WHERE id=1055;
UPDATE public.requisitos SET nombre='Registro Único Tributario (RUT) actualizado.'  WHERE id=1056;
UPDATE public.requisitos SET nombre='Registro de Información Tributaria (RIT) actualizado.'  WHERE id=1057;
UPDATE public.requisitos SET nombre='Certificado de aportes parafiscales y de seguridad social de la entidad participante.'  WHERE id=1058;
UPDATE public.requisitos SET nombre='Declaración de renta o de ingresos y patrimonio'  WHERE id=1059;
UPDATE public.requisitos SET nombre='Conjunto completo de estados financieros comparativos.'  WHERE id=1060;
UPDATE public.requisitos SET nombre='Certificación de estructura organizacional, de administración y control de la entidad participante.'  WHERE id=1061;
UPDATE public.requisitos SET nombre='Carta de compromiso de cofinanciación del proyecto, por parte de la entidad participante.'  WHERE id=1062;
UPDATE public.requisitos SET nombre='Mínimo cinco (5) y máximo ocho (8) certificaciones o actas de liquidación, expedidas por entidades públicas o privadas con las que la entidad participante haya suscrito contratos o convenios en los últimos cinco (5) años.'  WHERE id=1063;
UPDATE public.requisitos SET nombre='Certificación de personas políticamente expuestas (Decreto 1674 del 21de octubre de 2016).'  WHERE id=1064;

CREATE TABLE public.propuestasverificaciones
(
  id serial NOT NULL,
  propuesta integer NOT NULL,
  convocatoriadocumento integer NOT NULL,
  verificacion integer NOT NULL,
  estado integer NOT NULL,
  observacion TEXT,
  active bool NULL DEFAULT true,
  fecha_actualizacion timestamp without time zone,
  fecha_creacion timestamp without time zone,
  creado_por integer NOT NULL,
  actualizado_por integer,
  CONSTRAINT propuestasverificaciones_pkey PRIMARY KEY (id),
  CONSTRAINT propuestasverificaciones_propuesta_fkey FOREIGN KEY (propuesta)
      REFERENCES public.propuestas (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasverificaciones_convocatoriadocumento_fkey FOREIGN KEY (convocatoriadocumento)
      REFERENCES public.convocatoriasdocumentos (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasverificaciones_estado_fkey FOREIGN KEY (estado)
      REFERENCES public.estados (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT propuestasverificaciones_creado_por_fkey FOREIGN KEY (creado_por)
      REFERENCES public.usuarios (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION      
);


ALTER TABLE enfoques ADD COLUMN programa integer;

INSERT INTO public.enfoques (nombre, active, creado_por, programa) VALUES ('Multidisciplinar', true, 7, 3);

UPDATE public.enfoques SET programa=1 WHERE id<5;

INSERT INTO public.estados (tipo_estado, nombre, active, creado_por, orden) VALUES('propuestas', 'Subsanada', true, 7, 7);
